{# ### TEN SZABLON DZIEDZICZY Z base.html ### #}
{% extends "base.html" %}

{# ### DEFINIUJESZ TYLKO BLOK, KTÓRY CHCESZ ZMIENIĆ ### #}

{# Nadpisz blok 'title' #}
{% block title %}QR grades - Strona Główna{% endblock %}

{# Nadpisz blok 'content' główną treścią strony głównej #}
{% block content %}

      <!-- Section: Main chart -->
      <section class="mb-4">
        <div class="card">
          <div class="card-header py-3">
            <h5 class="mb-0 text-center"><strong>Sales</strong></h5>
          </div>
          <div class="card-body">
            <canvas
              data-mdb-chart-init
              data-mdb-chart="bar"
              data-mdb-dataset-label="Grades"
              data-mdb-labels="{{ etykiety }}"
              data-mdb-dataset-data="{{ wartosci }}"
            ></canvas>
          </div>
        </div>
      </section>
      <!-- Section: Main chart -->

     <!-- Section: Stars -->
      <section class="mb-4">
        <div class="card">
          <div class="card-body">

            {# Sprawdź, czy średnia ocena istnieje i jest liczbą #}
            {% if average_review is not none %}

            {# Oblicz zaokrągloną ocenę do najbliższej połówki #}
            {# Przykład: 4.3 -> 4.5, 3.8 -> 4.0, 4.7 -> 5.0 #}
            {# (average_review * 2) zaokrągla do najbliższego int, potem / 2.0 daje .0 lub .5 #}
            {% set rounded_score = (average_review * 2) | round / 2.0 %}
            {% set max_stars = 5 %} {# Całkowita liczba gwiazdek w systemie #}
            <h5 class="mb-0 text-center">
                <div class="star-rating">
                    {# Pętla przez 5 gwiazdek #}
                    {% for i in range(max_stars) %}
                        {% set current_star_threshold = i + 1 %} {# Próg dla danej gwiazdki (1, 2, 3, 4, 5) #}

                        {% if current_star_threshold <= rounded_score %}
                            {# Wyświetl pełną gwiazdkę, jeśli zaokrąglona ocena jest większa lub równa progowi #}
                            <i class="fas fa-star"></i> {# fas = Font Awesome Solid #}
                        {% elif (current_star_threshold - 0.5) <= rounded_score and rounded_score < current_star_threshold %}
                            {# Wyświetl pół gwiazdkę, jeśli zaokrąglona ocena jest między progiem a pół kroku poniżej #}
                            {# Ta logika jest trochę bardziej precyzyjna dla pół-gwiazdek #}
                             <i class="fas fa-star-half-alt"></i> {# fas = Font Awesome Solid #}
                        {% else %}
                            {# W przeciwnym razie wyświetl pustą gwiazdkę #}
                            <i class="far fa-star"></i> {# far = Font Awesome Regular #}
                        {% endif %}
                    {% endfor %}
                </div>

                {% else %}
                    <p>Brak dostępnej średniej oceny (brak danych lub recenzji z oceną numeryczną).</p>
                {% endif %}
            </h5>
          </div>
        </div>
      </section>
      <!-- Section: Stars -->

     <!-- Section: Form -->
      <section class="mb-4">
        <div class="card">
          <div class="card-body">

              <h1>Dodaj Nowy Wpis (Ascend)</h1>

                {# Wyświetlanie komunikatów flash (sukces/błąd) #}
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <ul class="flash-messages">
                        {% for category, message in messages %}
                            <li class="{{ category }}">{{ message }}</li>
                        {% endfor %}
                        </ul>
                    {% endif %}
                {% endwith %}

                {# Formularz do dodawania wpisu #}
                <form method="POST" action="{{ url_for('add_ascend') }}">
                    <div>
                        <label for="route_id">ID Trasy (ObjectId):</label>
                        <input type="text" id="route_id" name="route_id" required value="{{ initial_data.route_id | default('', true) }}">
                        {# value="{{ initial_data.route_id | default('', true) }}" zapamiętuje wprowadzone dane po błędzie #}
                    </div>
                    <div>
                        {# Główna etykieta dla całej grupy radio buttonów #}
                        <label>Ocena:</label>

                        {# Pamiętaj o zdefiniowaniu WSZYSTKICH możliwych opcji ocen #}

                        {# Opcja 1: Ocena 6a #}
                        <input type="radio" id="grade_6a" name="grade" value="6a"
                               {% if initial_data.grade == '6a' %}checked{% endif %} {# Zaznacz, jeśli '6a' było wcześniej wybrane #}
                               required> {# Pole jest wymagane - zaznaczamy tylko jeden z grupy jako required #}
                        <label for="grade_6a">6a</label>

                        {# Opcja 2: Ocena 6b #}
                        <input type="radio" id="grade_6b" name="grade" value="6b"
                               {% if initial_data.grade == '6b' %}checked{% endif %}> {# Nie powtarzamy required na kolejnych z tej grupy #}
                        <label for="grade_6b">6b</label>

                        {# Opcja 3: Ocena 6c #}
                        <input type="radio" id="grade_6c" name="grade" value="6c"
                               {% if initial_data.grade == '6c' %}checked{% endif %}>
                        <label for="grade_6c">6c</label>

                        {# Dodaj więcej opcji ocen w ten sam sposób, np. 7a, 7b, 7c, 8a, itd. #}
                        {# Pamiętaj o unikalnym id dla każdego inputa i odpowiadającej mu etykiecie for="..." #}

                        {# Przykład dla kolejnej opcji #}
                        {#
                        <input type="radio" id="grade_7a" name="grade" value="7a"
                               {% if initial_data.grade == '7a' %}checked{% endif %}>
                        <label for="grade_7a">7a</label>
                        #}

                    </div>

                    <div>
                        {# Główna etykieta dla całej grupy radio buttonów #}
                        <label>Recenzja (1-5):</label>

                        {# Pętla generująca radio buttony dla liczb od 1 do 5 #}
                        {# range(1, 6) wygeneruje sekwencję liczb 1, 2, 3, 4, 5 #}
                        {% for i in range(1, 6) %}
                            {# Tworzymy pojedynczy radio button #}
                            <input type="radio" id="review_{{ i }}" {# Unikalne ID, np. review_1, review_2, ... #}
                                   name="review" {# Wspólna nazwa dla całej grupy #}
                                   value="{{ i }}" {# Wartość przesyłana po zaznaczeniu (liczba jako string) #}
                                   {% if initial_data.review is defined and initial_data.review is not none and initial_data.review == i %}checked{% endif %} {# Zaznacz, jeśli wartość w initial_data pasuje do tej opcji #}
                                   {% if loop.first %}required{% endif %}> {# Oznacz pierwszy radio button jako wymagany (wymusza wybór z grupy) #}

                            {# Etykieta dla danego radio buttona #}
                            <label for="review_{{ i }}">{{ i }}</label>

                            {# Opcjonalnie dodaj spację lub inny separator między opcjami #}
                            {% if not loop.last %} &nbsp; {% endif %}
                        {% endfor %}
                    </div>

                    <div>
                        <label for="user">Użytkownik:</label>
                        <input type="text" id="user" name="user" required value="{{ initial_data.user | default('', true) }}">
                    </div>

                    <div>
                        <button type="submit">Zapisz Wpis</button>
                    </div>
                </form>

          </div>
        </div>
      </section>
      <!-- Section: Form -->

      <!--Section: QR code-->
      <section class="mb-4">
        <div class="card">
          <div class="card-header text-center py-3">
            <h5 class="mb-0 text-center">
              <strong>Route QR code</strong>
            </h5>
          </div>
          <div class="card-body">
            <h5 class="mb-0 text-center">
              <img src="https://qrades.onrender.com/qr/{{ initial_data.route_id | default('', true) }}">
            </h5>
          </div>
        </div>
      </section>
      <!--Section: Sales Performance KPIs-->

   {% endblock %}

{# Nie definiujemy innych bloków (head_extra, scripts_extra), jeśli nie są potrzebne #}